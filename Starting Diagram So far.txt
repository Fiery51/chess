actor Client
participant Server
participant Handler
participant Service
participant DataAccess
database db

entryspacing 0.6



//REGISTRATION
group#43829c #lightblue Registration
Client -> Server: [POST] /user\n{"username":" ", "password":" ", "email":" "}
Server -> Handler: {"username":" ", "password":" ", "email":" "}
Handler -> Service: register(RegisterRequest)
Service -> DataAccess: getUser(username)
DataAccess -> db:Find UserData by username
//I would think you'd error immeidatly? 
break User made a bad request
DataAccess --> Server: DataAccessException
Server --> Client: 400\n{"message": "Error: bad request"}
end
break User with username already exists
DataAccess --> Service: UserData
Service --> Server: AlreadyTakenException
Server --> Client: 403\n{"message": "Error: username already taken"}
end
//I assume if this is if we pull the data back and something is wrong with it?
break User data messed up
DataAccess --> Service: UserData
Service --> Server: DataAccessExcpetion
Server --> Client: 500\n{"message": "Error: (description of error)"}
end
DataAccess --> Service: null
Service -> DataAccess:createUser(userData)
DataAccess -> db:Add UserData
Service -> DataAccess:createAuth(authData)
DataAccess -> db:Add AuthData
Service --> Handler: RegisterResult
Handler --> Server: {"username" : " ", "authToken" : " "}
Server --> Client: 200\n{"username" : " ", "authToken" : " "}
end




//LOGIN
group#orange #FCEDCA Login
Client -> Server: [POST] /session\n{username, password}
Server -> Handler: {"username":" ", "password":" "}
Handler -> Service: login(LoginRequest)
Service -> DataAccess: authenticate(username)
DataAccess -> db:Find UserData by username
//Errors
break User made a bad request
DataAccess --> Server: DataAccessException
Server --> Client: 400\n{"message": "Error: bad request"}
end
break Unauthorized
DataAccess --> Service: false
Service --> Server: DataAccessExcpetion
Server --> Client: 401\n{"message": "Error: (unauthorized)"}
end
break User data messed up
DataAccess --> Service: null
Service --> Server: DataAccessExcpetion
Server --> Client: 500\n{"message": "Error: (description of error)"}
end
//Success
DataAccess --> Service: true
Service -> DataAccess:createAuth(authData)
  //auth token
DataAccess -> db:Add AuthData
Service --> Handler: LoginResult
Handler --> Server: {"username" : " ", "authToken" : " "}
Server --> Client: 200\n{"username" : " ", "authToken" : " "}
end







group#green #lightgreen Logout
Client -> Server: [DELETE] /session\nauthToken
Server -> Handler: 	authorization: <authToken>
Handler -> Service: logout(LogoutRequest)
Service -> DataAccess: validate(authToken)
DataAccess --> Service: true
Service -> DataAccess:deleteAuth(authData)
DataAccess -> db:Delete AuthData
Service --> Handler: LogoutResult
Handler --> Server: {}
Server --> Client: 200\n{}

break Unauthorized
DataAccess --> Service: false
Service --> Server: DataAccessExcpetion
Server --> Client: 401\n{"message": "Error: (unauthorized)"}
end

break User data messed up
DataAccess --> Service: null
Service --> Server: DataAccessExcpetion
Server --> Client: 500\n{"message": "Error: (description of error)"}
end

end








group#red #pink List Games
Client -> Server: [GET] /game\nauthToken
Server -> Handler: 	authorization: <authToken>
Handler -> Service: listGames(listGamesRequest)
Service -> DataAccess: validate(authToken)
DataAccess --> Service: true
Service -> DataAccess:getGames(authData)
DataAccess -> db:Get Games
Service --> Handler: List of Games
Handler --> Server: { "games": [{"gameID": 1234, "whiteUsername":"", "blackUsername":"", "gameName:""} ]}
Server --> Client: 200\n{{ "games": [{"gameID": 1234, "whiteUsername":"", "blackUsername":"", "gameName:""} ]}}

break Unauthorized
DataAccess --> Service: false
Service --> Server: DataAccessExcpetion
Server --> Client: 401\n{"message": "Error: (unauthorized)"}
end

break User data messed up
DataAccess --> Service: null
Service --> Server: DataAccessExcpetion
Server --> Client: 500\n{"message": "Error: (description of error)"}
end

end

group#d790e0 #E3CCE6 Create Game 
Client -> Server: [POST] /game\nauthToken\n{gameName}
Server -> Handler: 	{ "gameName":"" }, authorization: <authToken>
Handler -> Service: createGame(createGameRequest)
Service -> DataAccess: validate(authToken)
DataAccess --> Service: true
DataAccess -> db:Create Game
Service --> Handler: True
Handler --> Server: { "gameID": 1234 }
Server --> Client: 200\n{ "gameID": 1234 }

break User made a bad request
DataAccess --> Server: DataAccessException
Server --> Client: 400\n{"message": "Error: bad request"}
end
break Unauthorized
DataAccess --> Service: false
Service --> Server: DataAccessExcpetion
Server --> Client: 401\n{"message": "Error: (unauthorized)"}
end
break User data messed up
DataAccess --> Service: null
Service --> Server: DataAccessExcpetion
Server --> Client: 500\n{"message": "Error: (description of error)"}
end

end

group#yellow #lightyellow Join Game #black
Client -> Server: [PUT] /game\nauthToken\n{playerColor, gameID}
Server -> Handler: 	{ "playerColor":"WHITE/BLACK", "gameID": 1234 }, authorization: <authToken>
Handler -> Service: joinGame(joinGameRequest)
Service -> DataAccess: validate(authToken)
DataAccess --> Service: true
Service -> DataAccess: validateGame(gameID)
DataAccess -> db:Find game by name
DataAccess --> Service: true
Service -> DataAccess: validateColor(gameID)
DataAccess -> db:Find if color is available
break Already Taken
DataAccess --> Service: false
Service --> Server: DataAccessExcpetion
Server --> Client: 403\n{"message": "Error: (Already Taken)"}
end
Service --> Handler: True
Handler --> Server: {}
Server --> Client: 200\n{}

break User made a bad request
DataAccess --> Server: DataAccessException
Server --> Client: 400\n{"message": "Error: bad request"}
end
break Unauthorized
DataAccess --> Service: false
Service --> Server: DataAccessExcpetion
Server --> Client: 401\n{"message": "Error: (unauthorized)"}
end



break User data messed up
DataAccess --> Service: null
Service --> Server: DataAccessExcpetion
Server --> Client: 500\n{"message": "Error: (description of error)"}
end

end

group#gray #lightgray Clear application 
Client -> Server: [DELETE] /db
Server -> Handler: 	
Handler -> Service:deleteData(deleteRequest)
Service -> DataAccess: clearData()
DataAccess -> db:Clear data
DataAccess --> Service: true
Service --> Handler: True
Handler --> Server: {}
Server --> Client: 200\n{}
break User data messed up
DataAccess --> Service: null
Service --> Server: DataAccessExcpetion
Server --> Client: 500\n{"message": "Error: (description of error)"}
end
end
